<!DOCTYPE html>
<html>





<head>
  <title>Quarkus - Emitter - Bridging the imperative and the reactive worlds</title>
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/blog/reactive-messaging-emitter/" />
  <meta property="og:title" content="Emitter - Bridging the imperative and the reactive worlds" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/blog/reactive-messaging-emitter/">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/goan.js" type="text/javascript"></script>
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
</head>

<body class="post">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
  <div class="container">
    <div class="logo-wrapper">
      
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
      
    </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <div id="menu" class="menu">
      <span>
        <a href="/get-started/" class="">Get Started</a>
      </span>
      <span>
        <a href="/guides/" class="">Guides</a>
      </span>
      <span>
        <a href="/community/" class="">Community</a>
      </span>
      <span>
        <a href="/support/" class="">Support</a>
      </span>
      <span>
        <a href="/blog/" class="active">Blog</a>
      </span>
      <span>
        <a href="https://code.quarkus.io" class="button-cta secondary white">Start Coding</a>
      </span>
    </div>
  </div>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    <div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
    <div class="grid-wrapper">
      <div class="width-12-12">
        <p>
          <a href="/blog"><i class="fas fa-angle-left"></i> Back to all posts</a>
        </p>
      </div>
      <div class="width-12-12">
        <div class="post-date">
          October 06, 2020 
          
            <span class="tags"><a href="/blog/tag/reactive">#reactive</a><a href="/blog/tag/mutiny">#mutiny</a><a href="/blog/tag/messaging">#messaging</a><a href="/blog/tag/kafka">#kafka</a></span>
          
        </div>
        <h1 class="post-title">Emitter - Bridging the imperative and the reactive worlds</h1>
        <div class="grid-wrapper">
          <div class="width-8-12 width-12-12-m byline-wrapper">
            
            
              <img class="headshot" src="https://www.gravatar.com/avatar/ab937f7df990a673446f1e30fd9ccfba">
            
            <p class="byline">By Clement Escoffier</p>
          </div>
          <div class="width-12-12">
              <div class="paragraph">
<p>In a <a href="https://quarkus.io/blog/kafka-avro/">previous blog post</a> about Kafka and Avro, we used an <em>emitter</em> to send Kafka messages.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/assets/images/posts/reactive-messaging-emitter/architecture.png" alt="architecture" width="70%"></span></p>
</div>
<div class="paragraph">
<p>In this post, we are going look at this emitter construct a little bit more closely.</p>
</div>
<div class="sect1">
<h2 id="injecting-an-emitter"><a class="anchor" href="#injecting-an-emitter"></a>Injecting an Emitter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Injecting an emitter is straightforward.
You indicate the targeted channel, i.e., where do you send your messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject @Channel("movies") Emitter&lt;Movie&gt; emitter;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember that reactive messaging uses <em>channels</em> as a primary abstraction.
They can be in-memory channels or mapped to a remote broker.</p>
</div>
<div class="paragraph">
<p>In the previous code snippet, we inject an <code>Emitter&lt;Movie&gt;</code>.
It means you will send messages containing movies as payload.
So, the specified type is the payload type.
That lets you send: payloads directly (wrapped automatically in a message) or more detailed messages containing a movie as payload:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Movie movie = ...

// Send payloads directly
emitter.send(movie);

// Send messages
emitter.send(Message.of(movie));</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sending-payloads"><a class="anchor" href="#sending-payloads"></a>Sending payloads</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sending payload is the simplest way to send data.
You just pass the payload to the <code>send</code> method like an instance of <code>Movie</code>.
Under the hood, it just creates a simple <code>Message</code> wrapping the payload.</p>
</div>
<div class="paragraph">
<p>When used with payload, the <code>send</code> method returns a <code>CompletionStage</code> indicating if the message processing succeeded or failed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">emitter.send(movie)
    .whenComplete((success, failure) -&gt; {
        if (failure != null) {
            System.out.println("D'oh! " + failure.getMessage());
        } else {
            System.out.println("Message processed successfully");
        }
    });</code></pre>
</div>
</div>
<div class="paragraph">
<p>Processing, and will see later event the emission, happens asynchronously.
So, the returned <code>CompletionStage</code> lets you know when the message is processed.
The <code>CompletionStage</code> is completed successfully when the message is acknowledged.
Most of the time, it means that the processing has been completed smoothly, or the message has been sent to a broker successfully.
If something wrong happens, the <code>CompletionStage</code> is completed exceptionally.
The passed exception gives you an idea of the reason.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sending-messages"><a class="anchor" href="#sending-messages"></a>Sending messages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While sending payloads is more straightforward, sometimes you want to attach metadata to the message, like configuring how it should be written in Kafka, tracing information, etc.
The emitter also allows sending messages, and so attach the metadata you want.
In the following example, we configure the outbound Kafka record.
We set the key, the topic, and so on.
That way, you can dispatch messages to different topics and even decide dynamically:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">OutgoingKafkaRecordMetadata&lt;?&gt; metadata = OutgoingKafkaRecordMetadata.builder()
        .withTopic("movies")
        .withKey(movie.getYear())
        .build();
emitter.send(Message.of(movie).addMetadata(metadata));</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="emissions-are-asynchronous"><a class="anchor" href="#emissions-are-asynchronous"></a>Emissions are asynchronous</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Emitters form a bridge between the imperative and the reactive worlds.
When you emit a message, this message is not processed immediately.
The downstream component consuming the message are part of a <em>Reactive Streams</em>.
Passing the message immediately would violate the Reactive Streams protocol.
We must be sure that the downstream components are ready to accept this message.
As a result, the emitter is not pushing the message directly, but enqueue it in a buffer used to handle the downstream capacity (requests in Reactive Streams lingo).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/assets/images/posts/reactive-messaging-emitter/buffer.png" alt="buffer" width="90%"></span></p>
</div>
<div class="paragraph">
<p>The downstream component receives the messages according to the requests it makes, ensuring its capacity is never exceeded.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overflow-management"><a class="anchor" href="#overflow-management"></a>Overflow management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>But with buffer comes&#8230;&#8203; overflow.
If you emit too many messages and the downstream cannot keep up, the messages are stored in the buffer until it reaches its maximum capacity.
Then, you cannot emit anymore, and attempting to emit will throw exceptions.
But what can we do in this case?
When injecting the emitter, you can configure an Overflow strategy.
For example, you can set the buffer size, use an unbounded buffer, drop the messages, fail, or just ignore the back pressure and let the downstream handle it.
By default, it uses a buffer, but depending on your use case, you may want to configure it differently:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@Channel("movies")
@OnOverflow(value = OnOverflow.Strategy.BUFFER, bufferSize = 1000)
Emitter&lt;Movie&gt; emitter1;

@Inject
@Channel("movies")
@OnOverflow(value = OnOverflow.Strategy.NONE)
Emitter&lt;Movie&gt; emitter2;

@Inject
@Channel("movies")
@OnOverflow(value = OnOverflow.Strategy.UNBOUNDED_BUFFER)
Emitter&lt;Movie&gt; emitter3;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion"><a class="anchor" href="#conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This post is a brief introduction to the <code>Emitter</code> construct from Reactive Messaging.
More information is available on the <a href="https://smallrye.io/smallrye-reactive-messaging/smallrye-reactive-messaging/2.2/emitter/emitter.html">SmallRye Reactive Messaging documentation</a>.</p>
</div>
<div class="paragraph">
<p>In the next Quarkus version (1.9), this feature will be improved with two very nice enhancements.
First, it will offer a Mutiny variant, easing the integration with Mutiny APIs.
Then, it would be possible for the Kafka case to directly emit key/value pairs without needing to use metadata.</p>
</div>
<div class="paragraph">
<p>Stay tuned! Will will cover these in a follow-up post!</p>
</div>
</div>
</div>
              
          </div>
          <div class="width-12-12"><div class="share-page">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://quarkus.io/blog/reactive-messaging-emitter/&title=Emitter - Bridging the imperative and the reactive worlds" rel="nofollow" target="_blank" title="Share on LinkedIn">
    <img src="/assets/images/share-page/icons_social-linkedin.png"/>
  </a>
  <a class="share-twitter" href="https://twitter.com/intent/tweet?text=Emitter - Bridging the imperative and the reactive worlds&url=https://quarkus.io/blog/reactive-messaging-emitter/&via=quarkusio&related=quarkusio" rel="nofollow" target="_blank" title="Share on Twitter">
    <img src="/assets/images/share-page/icons_social-twitter.png"/>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://quarkus.io/blog/reactive-messaging-emitter/" rel="nofollow" target="_blank" title="Share on Facebook">
    <img src="/assets/images/share-page/icons_social-facebook.png"/>
  </a>
  <a class="share-reddit" href="http://www.reddit.com/submit?url=https://quarkus.io/blog/reactive-messaging-emitter/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
    <img src="/assets/images/share-page/icons_social-reddit.png"/>
  </a>
  <a class="share-email" href="mailto:?subject=Emitter - Bridging the imperative and the reactive worlds&amp;body=Emitter - Bridging the imperative and the reactive worlds https://quarkus.io/blog/reactive-messaging-emitter/" title="Share via Email" >
    <img src="/assets/images/share-page/icons_social-email.png"/>
  </a>
</div>
</div>
        </div>
      </div>
    </div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
            <li><a href="/">Home</a></li>
          
            <li><a href="/guides">Guides</a></li>
          
            <li><a href="/community/#contributing">Contribute</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
            <li><a href="/get-started">Get Started</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Contribute</span>
        <ul class="footer-links">
          
            <li><a href="https://twitter.com/quarkusio">Follow us</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
            <li><a href="/security">Security&nbsp;policy</a></li>
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus">Stack Overflow</a></li>
          
            <li><a href="https://quarkusio.zulipchat.com">Chat room</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">Development mailing list</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/search-filter.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
</body>

</html>
