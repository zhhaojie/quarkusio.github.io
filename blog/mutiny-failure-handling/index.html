<!DOCTYPE html>
<html>





<head>
  <title>Quarkus - How to handle failures with Mutiny</title>
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/blog/mutiny-failure-handling/" />
  <meta property="og:title" content="How to handle failures with Mutiny" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/blog/mutiny-failure-handling/">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/goan.js" type="text/javascript"></script>
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
</head>

<body class="post">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
  <div class="container">
    <div class="logo-wrapper">
      
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
      
    </div>
    <label class="nav-toggle" for="checkbox">
      <i class="fa fa-bars"></i>
    </label>
    <div id="menu" class="menu">
      <span>
        <a href="/get-started/" class="">Get Started</a>
      </span>
      <span>
        <a href="/guides/" class="">Guides</a>
      </span>
      <span>
        <a href="/community/" class="">Community</a>
      </span>
      <span>
        <a href="/support/" class="">Support</a>
      </span>
      <span>
        <a href="/blog/" class="active">Blog</a>
      </span>
      <span>
        <a href="https://code.quarkus.io" class="button-cta secondary white">Start Coding</a>
      </span>
    </div>
  </div>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    <div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
    <div class="grid-wrapper">
      <div class="width-12-12">
        <p>
          <a href="/blog"><i class="fas fa-angle-left"></i> Back to all posts</a>
        </p>
      </div>
      <div class="width-12-12">
        <div class="post-date">
          August 24, 2020 
          
            <span class="tags"><a href="/blog/tag/reactive">#reactive</a><a href="/blog/tag/mutiny">#mutiny</a></span>
          
        </div>
        <h1 class="post-title">How to handle failures with Mutiny</h1>
        <div class="grid-wrapper">
          <div class="width-8-12 width-12-12-m byline-wrapper">
            
            
              <img class="headshot" src="https://www.gravatar.com/avatar/ab937f7df990a673446f1e30fd9ccfba">
            
            <p class="byline">By Clement Escoffier</p>
          </div>
          <div class="width-12-12">
              <div class="paragraph">
<p>In the past week, I got several questions about failure handling with Mutiny. So, maybe it deserves a bit more explanation.</p>
</div>
<div class="sect1">
<h2 id="failures-are-events"><a class="anchor" href="#failures-are-events"></a>Failures are events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, Mutiny is an event-driven reactive programming library. With Mutiny, you handle events. An upstream <code>Uni</code> or <code>Multi</code> propagates these events and gives you the possibility to process them. These events can be <strong>item</strong>, <strong>completion</strong>, <strong>cancellation</strong>, and&#8230;&#8203; <strong>failure</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Multi.createFrom().range(0, 10)
    .onItem().invoke(i -&gt; System.out.println("Received item " + i))
    .onCompletion().invoke(() -&gt; System.out.println("We are done!"))
    .onCancellation().invoke(() -&gt; System.out.println(
        "The downstream does not want our items anymore!")
    )

    .onFailure().invoke(t -&gt; System.out.println(
        "Oh no! We received a failure: " + t.getMessage())
    )</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-can-you-do-when-you-receive-a-failure"><a class="anchor" href="#what-can-you-do-when-you-receive-a-failure"></a>What can you do when you receive a failure?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to calling an action, as shown in the previous snippet, there are multiple things you can do when you receive a failure.</p>
</div>
<div class="paragraph">
<p>The most common thing to do is to recover. You can recover by passing a specific item or with another <code>Uni</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">upstream
    .onFailure().recoverWithItem(failure -&gt; "hello (fallback)")
    .subscribe().with(i -&gt; System.out.println("Received: " + i));

upstream
    .onFailure().recoverWithUni(failure -&gt; getAnotherUni(failure))
    .subscribe().with(i -&gt; System.out.println("Received: " + i));</code></pre>
</div>
</div>
<div class="paragraph">
<p>On Multi, you can also recover by providing another <code>Multi</code> or completing the stream:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">upstream
  .onFailure().recoverWithCompletion();</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have faith in your system, you can also <strong>retry</strong>. Note that you need to make sure you can retry the operation safely first!</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">upstream
      .onFailure().retry()
        .withBackOff(Duration.ofSeconds(1), Duration.ofSeconds(10)).atMost(10)
      .subscribe().with(i -&gt; System.out.println("Received: " + i));</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also transform the failure. For example, you can map a low-level failure into something more business-friendly. It propagates that second failure downstream, hiding the low-level failure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Uni.createFrom().failure(new IOException("boom"))
      .onFailure().transform(t -&gt; new BusinessException(t))</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="failures-are-terminal"><a class="anchor" href="#failures-are-terminal"></a>Failures are terminal</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Failures are terminal events. If your upstream propagates a failure, it means it can&#8217;t operate normally. For Uni, that&#8217;s not a problem, as you can only have an item or a failure. But for multi, it&#8217;s a bit more complicated.</p>
</div>
<div class="paragraph">
<p>Even if you recover, by handling the failure, you won&#8217;t get the rest of the stream. Your upstream is &#8230;&#8203;Â <strong>kaputt</strong>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;String&gt; list = Multi.createFrom().range(0, 10)
      .onItem().invoke(v -&gt; {
              if (v == 7) {
                throw new IllegalArgumentException("We don't like seven!");
              }
      })
      .onFailure().recoverWithItem(7)
      .map(integer -&gt; integer.toString())
      .onItem().invoke(s -&gt; System.out.println(s))
      .collectItems().asList()
      .await().indefinitely();</code></pre>
</div>
</div>
<div class="paragraph">
<p>It produces [1, 2, 3, 4, 5, 6, 7] and not the rest of the stream. When the <code>onItem().invoke()</code> stage is called with <code>7</code>, it produces a failure. That stops the stream. It does not process more items from upstream.</p>
</div>
<div class="paragraph">
<p>So what can we do? Isolate!</p>
</div>
<div class="paragraph">
<p>When a <strong>stage</strong> sends a failure, it sends a failure terminating the stream and cancels its subscription to the upstream (informing that it does not need more items as it&#8217;s not operating correctly). So, if we need to continue processing the other items from upstream; we just need to isolate that failure and be sure we do not cancel our subscription to the upstream.</p>
</div>
<div class="paragraph">
<p>The most common approach to achieve this is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">List&lt;String&gt; list = Multi.createFrom().range(0, 10)
    .onItem().transformToUniAndConcatenate(i -&gt;
            // Isolate the failure in this block
            Uni.createFrom().item(i)
                    .onItem().invoke(v -&gt; {
                        if (v == 7) {
                            throw new IllegalArgumentException("We don't like seven!");
                        }
                    })
                    .onFailure().recoverWithItem(7)
    )
    .map(integer -&gt; integer.toString())
    .onItem().invoke(s -&gt; System.out.println(s))
    .collectItems().asList()
    .await().indefinitely();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Basically, we isolate the potentially failing operation. If it fails, we recover. But the cancellation only cancels that item, not the full stream, meaning we will receive the next one item and so on. This code produces the expected list.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary"><a class="anchor" href="#summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here you go, you can now handle failure and continue the streams gracefully.</p>
</div>
<div class="paragraph">
<p>If you want to know more about Mutiny, check the following video:</p>
</div>
<iframe width="560" height="315" src="https://www.youtube.com/embed/kWlrGtwvOxg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>
</div>
              
          </div>
          <div class="width-12-12"><div class="share-page">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://quarkus.io/blog/mutiny-failure-handling/&title=How to handle failures with Mutiny" rel="nofollow" target="_blank" title="Share on LinkedIn">
    <img src="/assets/images/share-page/icons_social-linkedin.png"/>
  </a>
  <a class="share-twitter" href="https://twitter.com/intent/tweet?text=How to handle failures with Mutiny&url=https://quarkus.io/blog/mutiny-failure-handling/&via=quarkusio&related=quarkusio" rel="nofollow" target="_blank" title="Share on Twitter">
    <img src="/assets/images/share-page/icons_social-twitter.png"/>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://quarkus.io/blog/mutiny-failure-handling/" rel="nofollow" target="_blank" title="Share on Facebook">
    <img src="/assets/images/share-page/icons_social-facebook.png"/>
  </a>
  <a class="share-reddit" href="http://www.reddit.com/submit?url=https://quarkus.io/blog/mutiny-failure-handling/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
    <img src="/assets/images/share-page/icons_social-reddit.png"/>
  </a>
  <a class="share-email" href="mailto:?subject=How to handle failures with Mutiny&amp;body=How to handle failures with Mutiny https://quarkus.io/blog/mutiny-failure-handling/" title="Share via Email" >
    <img src="/assets/images/share-page/icons_social-email.png"/>
  </a>
</div>
</div>
        </div>
      </div>
    </div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. All dependencies of this project are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a>, is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what youâve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links">
          
            <li><a href="/">Home</a></li>
          
            <li><a href="/guides">Guides</a></li>
          
            <li><a href="/community/#contributing">Contribute</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
            <li><a href="/get-started">Get Started</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Contribute</span>
        <ul class="footer-links">
          
            <li><a href="https://twitter.com/quarkusio">Follow us</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
            <li><a href="/security">Security&nbsp;policy</a></li>
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links">
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus">Stack Overflow</a></li>
          
            <li><a href="https://quarkusio.zulipchat.com">Chat room</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">Development mailing list</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkus is made of community projects</span>
        <ul class="footer-links">
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://code.quarkus.io/" target="_blank">And many more...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/search-filter.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
</body>

</html>
